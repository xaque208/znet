{{- if eq .File.GetName "inventory.proto"}}
// Code generated, do not edit
package cmd

import (
	"strings"

	prompt "github.com/c-bata/go-prompt"
	log "github.com/sirupsen/logrus"
	"github.com/xaque208/znet/internal/inventory"
)

  {{- $messages := list "L3Network" "NetworkHost" "ZigbeeDevice" "IOTZone" }}

type inventoryInteractive struct {
	inv inventory.Inventory
}

func (i *inventoryInteractive) executor(in string) {
	in = strings.TrimSpace(in)
	blocks := strings.Split(in, " ")

	switch blocks[0] {
	case "list":
		switch blocks[1] {
  {{- range .File.MessageType }}
    {{- if has .GetName $messages }}
      {{- $typeName := (.GetName|snakeCase)}}
      {{- $commandName := (.GetName)}}
		case "{{$typeName}}":
			i, err := i.inv.List{{$commandName}}s()
			if err != nil {
				log.Error(err)
			}

			log.Infof("i: %+v", i)
    {{- end }}
  {{- end }}
		}
	case "get":
		item := blocks[2]

		switch blocks[1] {
  {{- range .File.MessageType }}
    {{- if has .GetName $messages }}
      {{- $typeName := (.GetName|snakeCase)}}
      {{- $commandName := (.GetName)}}
		case "{{$typeName}}":
			i, err := i.inv.Fetch{{$commandName}}(item)
			if err != nil {
				log.Error(err)
			}

			log.Infof("i: %+v", i)
    {{- end }}
  {{- end }}
		}
	}

}

func (i *inventoryInteractive) completer(d prompt.Document) []prompt.Suggest {
	blocks := strings.Split(d.CurrentLine(), " ")

	objects := []prompt.Suggest{
  {{- range .File.MessageType }}
    {{- if has .GetName $messages }}
      {{- $typeName := (.GetName|snakeCase)}}
      {{- $commandName := (.GetName)}}
		{Text: "{{$typeName}}", Description: "{{$commandName}} objects"},
    {{- end }}
  {{- end }}
	}

	s := []prompt.Suggest{
		{Text: "list", Description: "List objects"},
		{Text: "get", Description: "Get an object"},
	}

	count := len(blocks)

	if count > 0 {
		switch blocks[0] {
		case "list":
			if count > 2 {
				return []prompt.Suggest{}
			}
			return prompt.FilterHasPrefix(objects, d.GetWordBeforeCursor(), true)

		case "get":
			if count > 3 {
				return []prompt.Suggest{}
			}

			if count == 1 {
				return prompt.FilterHasPrefix(objects, d.GetWordBeforeCursor(), true)
			}

			switch blocks[1] {
  {{- range .File.MessageType }}
    {{- if has .GetName $messages }}
      {{- $typeName := (.GetName|snakeCase)}}
      {{- $commandName := (.GetName)}}
			case "{{$typeName}}":
				sugg := []prompt.Suggest{}
				results, err := i.inv.List{{$commandName}}s()
				if err != nil {
					log.Error(err)
					return []prompt.Suggest{}
				}

				for _, r := range results {
					sugg = append(sugg, prompt.Suggest{Text: r.GetName(), Description: r.GetDescription()})
				}
				return prompt.FilterHasPrefix(sugg, d.GetWordBeforeCursor(), true)
    {{- end }}
  {{- end }}
			}

			return prompt.FilterHasPrefix(objects, d.GetWordBeforeCursor(), true)
		}
	}

	return prompt.FilterHasPrefix(s, d.GetWordBeforeCursor(), true)
}

{{- end }}
